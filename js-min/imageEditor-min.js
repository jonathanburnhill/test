const openModal=document.querySelector("#openModal"),modal=document.querySelector(".modal"),modalFilter=document.querySelector(".modal-filter"),cancel=document.querySelector(".cancel"),save=document.querySelector(".save"),result=document.querySelector(".result"),imgSelect=document.querySelector("#img-select"),filePicker=document.querySelector("#file-picker"),filterStart=document.querySelector(".filter-start"),allowFilter=document.querySelector(".allow-filter"),filterImg=document.querySelector("#canvas"),imageOptions=document.querySelectorAll(".image-options"),add=document.querySelector(".add"),orderNum=document.querySelector(".order-num"),photos=document.querySelector(".photos"),buyNow=document.querySelector(".buy-now"),btnFB=document.querySelector(".btn-fb"),btnAddress=document.querySelector(".btn-address"),addText=document.querySelector(".addText");let rawImg,selectedFile;document.querySelector(".to-close").addEventListener("click",()=>{modal.classList.remove("modal-visible")});let containerWidth,viewportSize;499>document.documentElement.clientWidth?(containerWidth=document.documentElement.clientWidth,viewportSize=250):500<document.documentElement.clientWidth&&600>document.documentElement.clientWidth?(containerWidth=500,viewportSize=350,modal.style.height="750px"):(containerWidth=600,viewportSize=400,modal.style.height="900px"),imgSelect.addEventListener("click",function(a){filePicker&&filePicker.click(),a.preventDefault()},!1);var vanilla=new Croppie(result,{viewport:{width:viewportSize,height:viewportSize},boundary:{width:containerWidth,height:containerWidth},enableExif:!0});const chooseImg=function(a){const b=new FileReader;b.onload=function(a){modal.classList.add("modal-visible"),rawImg=a.target.result,vanilla.bind({url:rawImg})},b.readAsDataURL(a.target.files[0]),selectedFile=a.target.files[0],console.log(selectedFile)};save.addEventListener("click",function(){vanilla.result({type:"canvas",format:"jpeg",size:viewportSize,size:"original",quality:1}).then(function(a){filterStart.setAttribute("src",a),modal.classList.remove("modal-visible"),filterStart.style.width=`${viewportSize}px`,filterStart.style.height=`${viewportSize}px`,add.disabled=!1,modalFilter.classList.add("modal-visible"),filterStart.addEventListener("load",function(){"666">filterStart.naturalWidth&&(modalFilter.classList.remove("modal-visible"),modal.classList.add("modal-visible"),alert("Images are too small for our product either zoom out a little bit or choose another image"))}),filePicker.value="",document.querySelector(".address-form").style.display="block"})}),modal.classList.contains("modal-visible")&&console.log("hi there"),document.querySelector("#file-picker").addEventListener("change",chooseImg,!1),cancel.addEventListener("click",()=>{modal.classList.remove("modal-visible")}),document.querySelector(".back").addEventListener("click",function(){modalFilter.classList.remove("modal-visible"),modal.classList.add("modal-visible")});const img=new Image,applyFilter=a=>document.querySelector(a);applyFilter("#greyscale").addEventListener("click",function(){const a=document.querySelector("#greyscale");a.textContent="Loading...",Caman("#canvas",img,function(){modalFilter.classList.contains("checked")?(this.reloadCanvasData(),this.revert(!1),this.render(),this.greyscale().render()):modalFilter.classList.contains("allow-filter")?(this.greyscale().render(),modalFilter.classList.remove("allow-filter"),modalFilter.classList.add("checked")):(this.reloadCanvasData(),this.revert(!1),this.render(),modalFilter.classList.add("allow-filter")),a.textContent="Greyscale"})}),applyFilter("#vintage").addEventListener("click",function(){const a=document.querySelector("#vintage");a.textContent="Loading...",Caman("#canvas",img,function(){modalFilter.classList.contains("checked")?(this.reloadCanvasData(),this.revert(!1),this.render(),this.vintage().render()):modalFilter.classList.contains("allow-filter")?(this.vintage().render(),modalFilter.classList.remove("allow-filter"),modalFilter.classList.add("checked")):(this.reloadCanvasData(),this.revert(!1),this.render(),modalFilter.classList.add("allow-filter")),a.textContent="Vintage"})}),applyFilter("#oldboot").addEventListener("click",function(){const a=document.querySelector("#oldboot");a.textContent="Loading...",Caman("#canvas",img,function(){modalFilter.classList.contains("checked")?(this.reloadCanvasData(),this.revert(!1),this.render(),this.oldBoot().render()):modalFilter.classList.contains("allow-filter")?(this.oldBoot().render(),modalFilter.classList.remove("allow-filter"),modalFilter.classList.add("checked")):(this.reloadCanvasData(),this.revert(!1),this.render(),modalFilter.classList.add("allow-filter")),a.textContent="Old  Boot"})}),applyFilter("#orange-peel").addEventListener("click",function(){const a=document.querySelector("#orange-peel");a.textContent="Loading...",Caman("#canvas",img,function(){modalFilter.classList.contains("checked")?(this.reloadCanvasData(),this.revert(!1),this.render(),this.orangePeel().render(),a.style.backgroundColor="#f70d0e"):modalFilter.classList.contains("allow-filter")?(this.orangePeel().render(),modalFilter.classList.remove("allow-filter"),modalFilter.classList.add("checked")):(this.reloadCanvasData(),this.revert(!1),this.render(),modalFilter.classList.add("allow-filter")),a.textContent="Orange"})}),applyFilter("#love").addEventListener("click",function(){const a=document.querySelector("#love");a.textContent="Loading...",Caman("#canvas",img,function(){modalFilter.classList.contains("checked")?(this.reloadCanvasData(),this.revert(!1),this.render(),this.love().render(),a.style.backgroundColor="#f70d0e"):modalFilter.classList.contains("allow-filter")?(this.love().render(),modalFilter.classList.remove("allow-filter"),modalFilter.classList.add("checked")):(this.reloadCanvasData(),this.revert(!1),this.render(),modalFilter.classList.add("allow-filter")),a.textContent="Love"})}),applyFilter("#sunrise").addEventListener("click",function(){const a=document.querySelector("#sunrise");a.textContent="Loading...",Caman("#canvas",img,function(){modalFilter.classList.contains("checked")?(this.reloadCanvasData(),this.revert(!1),this.render(),this.sunrise().render(),a.style.backgroundColor="#f70d0e"):modalFilter.classList.contains("allow-filter")?(this.sunrise().render(),modalFilter.classList.remove("allow-filter"),modalFilter.classList.add("checked")):(this.reloadCanvasData(),this.revert(!1),this.render(),modalFilter.classList.add("allow-filter")),a.textContent="Sunrise"})}),applyFilter("#hazydays").addEventListener("click",function(){const a=document.querySelector("#hazydays");a.textContent="Loading...",Caman("#canvas",img,function(){modalFilter.classList.contains("checked")?(this.reloadCanvasData(),this.revert(!1),this.render(),this.hazyDays().render(),a.style.backgroundColor="#f70d0e"):modalFilter.classList.contains("allow-filter")?(this.hazyDays().render(),modalFilter.classList.remove("allow-filter"),modalFilter.classList.add("checked")):(this.reloadCanvasData(),this.revert(!1),this.render(),modalFilter.classList.add("allow-filter")),a.textContent="Hazy"})}),applyFilter("#reset").addEventListener("click",function(){Caman("#canvas",img,function(){this.reloadCanvasData(),this.revert(!1),this.render()})});const priceUpdate=document.querySelector(".price-update");priceUpdate.innerHTML=0;let val=0,textAnimation=()=>{let a=document.querySelector(".btn-upload");a.classList.add("text-decoration-animation")};document.querySelector(".add").addEventListener("click",function(){console.log("clicked"),Caman("#canvas",img,function(){const a=new Image;a.setAttribute("src",this.toBase64()),a.setAttribute("class","result-position"),add.disabled=!0,photos.insertAdjacentElement("afterbegin",a),modalFilter.classList.remove("modal-visible"),document.querySelector(".is-hidden").style.display="block",document.querySelector(".buy-now-form").style.display="block",document.querySelector(".address-form").style.display="none",document.querySelector(".btn-confirm").style.display="none",this.reloadCanvasData(),this.revert(!1),document.querySelector(".filter-start").removeAttribute("data-camen-id"),document.querySelector("#file-picker").val="",vanilla.bind({url:""}),window.scrollTo(0,0),textAnimation()})}),document.getElementById("name").addEventListener("focus",function(){console.log("hey, focused ;")}),val+=1,orderNum.innerHTML=`${val} x tiles.`,priceUpdate.innerHTML=2>val&&0<val?`£${10*val}`:2<=val&&3>val?`£${10*(.9*val)}`:`£${Math.floor(10*(.8*val))}`,console.log(val);const fbLogin=function(){const a=document.createElement("button");return a.setAttribute("class","fb-login"),a.onclick=fbLoginSettings(),a};buyNow.addEventListener("click",function(){document.querySelector(".is-hidden").style.display="none",firebase.auth().onAuthStateChanged(a=>{a?(document.querySelector(".address-form").style.display="block",document.querySelectorAll(".btn-confirm").style.display="block"):document.querySelector(".buy-now-form").style.display="block"})}),Caman("#canvas",img,function(){this.render()}),document.querySelector(".fb-login").addEventListener("click",()=>{const a=new firebase.auth.FacebookAuthProvider,b=firebase.auth().signInWithPopup(a);b.then(function(a){console.log(a),document.querySelector(".buy-now-form").style.display="none",document.querySelector(".address-form").style.display="block",document.querySelector(".btn-confirm").style.display="block",window.scrollTo({top:200,behavior:"smooth"})}).catch(function(a){console.log(a)})}),document.querySelector("#btnSignUp").addEventListener("click",()=>{const a=document.querySelector("#txtEmail").value,b=document.querySelector("#txtPassword").value;firebase.auth().createUserWithEmailAndPassword(a,b).catch(function(a){console.log(a.message)})}),document.querySelector("#btnLogin").addEventListener("click",()=>{const a=document.querySelector("#txtEmail").value,b=document.querySelector("#txtPassword").value;firebase.auth().signInWithEmailAndPassword(a,b).catch(a=>console.log(a.message))}),firebase.auth().onAuthStateChanged(a=>{a?document.querySelector("#btnLogOut").classList.remove("hide"):document.querySelector("#btnLogOut").classList.add("hide")}),document.querySelector("#btnLogOut").addEventListener("click",()=>{firebase.auth().signOut(),console.log("logged out")});const sendOrderAddress=document.getElementsByClassName("user-input");let newOrder={};btnAddress.addEventListener("click",function(){let a=document.querySelector("#name").value,b=document.querySelectorAll(".result-position"),c=[];const d=firebase.storage().ref();var e=firebase.firestore();let f,g,h=[];b.forEach(function(i){let j=i.getAttribute("src");f=j.substring(22),h.push(f),console.log(h),h.forEach(()=>{let i=Math.round(new Date().getTime()/Math.floor(20*Math.random()));d.child(`${a}/${i}`).putString(`${f}`,"base64",{contentType:"image/jpeg"}).then(()=>{console.log(h),d.child(`${a}/${i}`).getDownloadURL().then(function(a){console.log(a),c.push({time:i,source:a}),console.log(c);for(let b=0,c=sendOrderAddress.length;b<c;b++){let a=sendOrderAddress[b].getAttribute("data-key"),c=sendOrderAddress[b].value;newOrder[a]=c}c.length===b.length&&(g=Object.assign({},newOrder,c),console.log(g),e.push(g,function(){console.log("data has been inserted :)")}))})})})})});